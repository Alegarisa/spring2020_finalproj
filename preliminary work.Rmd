---
title: "Preliminary Ideas"
author: "JP"
date: "4/28/2020"
output: html_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, cache = TRUE)
```

# Preliminary Ideas

```{r download data function}
library(tidyverse)
library(here)
library(rio)

# Links are all the same, not sure why its not working

download_github <- function(year) {
  file <- glue::glue('https://raw.githubusercontent.com/Jim-Wright90/spring2020_finalproj/master/data/safe{year}.csv')
  rio::import(file, setclass = "tibble")
}

download_github(08)

# data only downloads from the 2017-2018 year

data <- map_df(c(06, 08, 18), ~download_github(.x))


download <- function(df1, df2, df3) {
  df1 <- readr::read_csv('https://raw.githubusercontent.com/Jim-Wright90/spring2020_finalproj/master/data/safe06.csv') %>% 
  dplyr::select(-X1)
  
  df2 <- readr::read_csv('https://raw.githubusercontent.com/Jim-Wright90/spring2020_finalproj/master/data/safe08.csv') %>% 
  dplyr::select(-X1)
  
  df3 <- readr::read_csv('https://raw.githubusercontent.com/Jim-Wright90/spring2020_finalproj/master/data/safe18.csv') %>% 
  dplyr::select(-X1)
  
  bind_rows("05-06 Survey" = df1, 
                      "07-08 Survey" = df2, 
                      "17-18 Survey" = df3, 
                      .id = "dataset")
}

d <- download()

```

```{r two variants of map used}

```

```{r walk reduce or modify used}

```

```{r parallel iteration}

```

```{r nest and mutate}

```


```{r two functions}
names(d)
str(d)

ggplot(d, aes(ic0290, c0534)) +
  geom_point() +
  geom_smooth(se = FALSE, method = 'lm')

# install.packages('ggridges')

library(ggridges)

ggplot(d, aes(fr_urban, c0534)) +
  geom_point(alpha = .4, color = 'gray70') +
  geom_boxplot() +
  coord_flip()

ggplot(d, aes(x = c0534, y = fr_urban, fill = fr_urban)) +
  geom_density_ridges(alpha = .4) +
  viridis::scale_fill_viridis(discrete = TRUE)

```

```{r}
numeric_plot <- function(df, x, y){
  plot_num <- ggplot({{df}}, aes({{x}}, {{y}})) +
      geom_point(alpha = .4, color = 'gray70') +
      geom_smooth(method = 'lm')
  
  if(!as.numeric({{x}}) & !as.numeric({{y}})){
    stop()
  }
  else{
    plot_num
  }
  return(plot_num)
}

numeric_plot(d, d$c0534, d$c0536)
  
# might be able to nest data and group_by to the various years 
density_plot <- function(df, x, y, fill){
  plot_cat <- ggplot({{df}}, aes({{x}}, {{y}}, {{fill}})) +
  geom_density_ridges()
  
  if(!as.numeric({{x}}) & !as.numeric({{y}})){
    stop()
  }
  else{
    plot_cat
  }
return(plot_cat)
}

density_plot(d, d$c0534, d$fr_urban) + 
  geom_density_ridges(alpha = .4, aes(fill = d$fr_urban)) +
  viridis::scale_fill_viridis(discrete = TRUE)


# need a way to figure out how to look at either variable by choosing from the previous two functions
plot_choice <- function(df, x, y){
  if(density_plot){
    return(density_plot)
  }
  else{
    numeric_plot
  }
}

plot_choice(d, d$c0534, d$fr_size)
```


```{r accessible through web}

```



# Grading Rubric

No code is used repetitively (no more than twice) [10 points]
More than one variant of purrr::map is used [10 points]
At least one {purrr} function outside the basic map family (walk_*, reduce, modify_*, etc.) [10 points]
At least one instance of parallel iteration (e.g., map2_*, pmap_*) [10 points]
At least one use case of purrr::nest %>% mutate() [10 points]
At least two custom functions [20 points; 10 points each]
Each function must do exactly one thing
The functions may replicate the behavior of a base function - as noted above this is about practicing the skills you learn in class
Code is fully reproducible and housed on GitHub [10 points]
No obvious errors in chosen output format [10 points]
Deployed on the web and shareable through a link [10 points]



Since we discussed creating models, it might be easier to create scatterplots showing the associations and then have a visual next to it that shows the strength of the correlation. Then our audience can check the listed predictors on a dropdown menu and the outcomes to see each of the associations in scatterpots. Just an idea. 

### Potential Outcomes 
number students involved in insubordination total = c0508
number of removals for insubordination = c0510
insubordination suspension = c0514, this variable is in both datasets
total off school suspensions = outsus08 for 07-08, outsus06 for 05-06, outsus18 for 17-18
percentage of students likely to go to college = c0534
percentage students academic achievement important = c0536

* Can't find c0508, c0510, or co514 in 17-18 data set 

### Potential Predictors
average percentage daily attendance = c0568
school size = fr_size
student counseling/social work = c0178
individual mentoring/tutoring = c0180 - c0181 in 17-18
recreation/student activities = c0182 - can't find in 17-18
provide training/assistance to parents = c0192
program involves parents at school = c0194
parental involvement back to school night = c0196
parent participates parent-teacher conference = c0198
parent participates in subject-area events = c0200 - can't find in 17-18
parent volunteers at school = c0202 - can't find in 17-18

Maybe things changed in coding by the time the 17-18 survey was conducted because I can't find a lot of the variables JP identified in the 05-06 and 07-08. Here are some that seem similar in 17-18:
student involvement in peer mediation = c0175
student involvement in restorative circles = c0179
promote sense of community integration = c0186


### Additional Predictors
1. Percent of minority student enrollment 
  * fr_catmn both data sets 
    * 1 = less than 5 percent
    * 2 = 5 to less than 20 percent
    * 3 = 20 to less than 50 percent
    * 4 = 50 percent or more 

2. School Level
  * fr_lvel in both data sets 
    * 1 = Elementary
    * 2 = Middle
    * 3 = High School (Secondary)
    * 4 = Combined Middle School and High School
    
3. School Urbanicity 
  * fr_urban for both data sets
  * 1 = City
  * 2 = Suburb (coded as "urban fringe" in 05-06 data set)
  * 3 = Town
  * 4 = Rural 

4. Size (fr_size) levels
  * 1 = < 300
  * 2 = 300 - 499
  * 3 = 500 - 999
  * 4 1,000 or more